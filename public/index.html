<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <title>ELO player</title>
    <link rel="icon" type="image/png"
        href="https://cdn.pixabay.com/photo/2016/03/23/20/49/music-note-1275650_960_720.png">
    <style>
        .background {
            position: absolute;
            background-image: url("./covers/Scorpion.png") center center;
            background-size: cover;
            transform-origin: top left;
            z-index: -1;
            height: 120%;
            width: 120%;
            margin: -10%;
            filter: blur(10px);
            -webkit-filter: blur(10px);
        }
       .album-music, .album-artist{
            background-color: rgba(89, 89, 89, 0.226);
            color: whitesmoke;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: rgba(255,255,255,0.4);
            font-size: 150%;
                 width: 66%;
           text-align:  center;
           margin-left: auto;
            margin-right: auto 
        }
        ::-webkit-scrollbar {
            width: 20px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            box-shadow: inset 0 0 5px grey;
            border-radius: 10px;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: #4d4d4d;
            border-radius: 10px;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: #262626;
        }

        .current-playlist {
            background-color: #333333;
            display: block;
            float: right;
            height: 90%;
            width: 65%;
            border-radius: 10px;
            border: 0.01% solid;
            padding-top: 1%;
            margin-top: 1%;
            margin-right: 1%;
          
        }

        button {
            background-color: #262626;
            color: whitesmoke;
            border: thin #262626 solid;
            margin: 1%;
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            float: left;
            width: 99%;
            height: 5%;
            padding: 1%;
        }

        body {
            background-color: #1a1a1a;
        }

        .left-menu {
            float: left;
            background-color: #595959;
            color: whitesmoke;
            height: 85%;
            width: 10%;
            margin-left: 0.5%;
            border-radius: 2%;
            opacity: 0.5;
            overflow-y: scroll;
            padding-bottom: 0.5%;
            padding-top: 0.5%;
            padding-left: 0.25%;
            padding-right: 0.25%l

        }

        .main {
            color: whitesmoke;
        }

        .footer {
            background-color: #262626;
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            border-radius: 1%;
            color: white;
            text-align: center;
            height: 15%;
            opacity: 0.7;
        }

        .album {
            width: 50px;
            height: 50px;
            min-width: 20px;
            min-height: 20px;
            float: left;
            border: medium whitesmoke solid;
            margin: 3%;
            border-radius: 50px;
        }

        .now-playing {
            position: fixed;
            float: left;
            height: 30%;
            width: 30%;
            min-width: 180px;
            display: flex;
            padding-left: 1%;
            padding-bottom: 2%;
        }

        .artist {
            float: left;
            width: 30%;
            height: 25%;
            text-align: center;
            font-family: 'Times New Roman', Times, serif;
            text-decoration-style: wavy;
            margin: 2%
        }

        .song-name {
            float: left;
            width: 40%;
            height: 30%;
            text-align: center;
            font-size: initial;
            margin: 2%;
        }

        .song {
            width: 100%;
            height: 50%;
            font-size: initial;
            background-color: #000;
            border-radius: 25px;
            align-content: center;
            max-width: 500px;
            border-bottom-left-radius: 0%;
            border-bottom-right-radius: 0%;
        }

        img {
            border-radius: 30%;
            border: 1px;
            width: 100%;
            height: 100%;
        }

        #right-song-play {
            align-self: center;
            margin: 2%;
        }

        audio {
            width: 70%;
            height: 20%;
        }

        .player {
            width: 150%;
            height: 110%;
            margin-bottom: 5%;
        }

        .disco-cover {
            background-image: url("./covers/Scorpion.png") center center;
            background-size: cover;
            width: 200px;
            height: 200px;
            border-radius: 4px;
            overflow: hidden;
            z-index: 10;
            transition: transform 800ms cubic-bezier(0.39, 0.575, 0.565, 1);
        }

        .disco-center {
            width: 61px;
            height: 61px;
            position: relative;
            top: 70px;
            left: 70px;
            /* text-align: center; */
            border-radius: 50%;
            background-image: url("./covers/Scorpion.png");
            background-size: cover;
        }
    </style>

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet prefetch" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <script>
        var playlist = [];
        var numberofsongs;

        function httpGet(theUrl) {
            var xmlHttp = null;
            xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", theUrl, false);
            xmlHttp.send(null);
            return xmlHttp.responseText;
        }

        function getnumberofsongs() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    numberofsongs = this.responseText;
                    console.log('number: ' + numberofsongs)
                }
            }
            try {
                //  console.log('im trying ')
                xhttp.open('GET', 'number.txt', false)
                xhttp.send();
                return numberofsongs;
            } catch (error) {
                console.log('error: ' + error)
            }
        }

        function play(song, artist, cover) {
            var audio = document.getElementById('right-song-play');
            var buffer = audio.buffered
            console.log('Buffer ' + audio.duration)
            audio.src = 'http://localhost:3003/music?id=' + song + '.mp3&name=' + song + '.mp3&artist=' + artist +
                '&album=' + cover;
            audio.onloadeddata = function () {
                document.getElementById('artist').innerText = artist;
                document.getElementById('songn').innerText = song;
                document.getElementById("track_artist").innerText = artist;
                document.getElementById("track_name").innerText = song;
                document.getElementById('cover').setAttribute('src', '../public/covers/' + cover + '.PNG')
                cover.toString()
                console.log('play(' + song + ',' + artist + ',' + cover + ')')
                document.getElementById('background').style.backgroundImage = 'url(../public/covers/' + cover +
                    '.PNG)';
                document.getElementById('disco-cover').style.backgroundImage = 'url(../public/covers/' + cover +
                    '.PNG)';
                document.getElementById('disco-center').style.backgroundImage = 'url(../public/covers/' + cover +
                    '.PNG)';
                console.log('Audio link : ' + audio.src)
            }

        }

        function play2(song, artist, cover) {
            var audio = document.getElementById('right-song-play');
            audio.src = 'http://localhost:3003/music?id=' + song + '.mp3&name=' + song + '.mp3&artist=' + artist +
                '&album=' + cover;
            audio.onloadeddata = function () {
                document.getElementById('artist').innerText = artist;
                document.getElementById('songn').innerText = song;
                document.getElementById("track_artist").innerText = artist;
                document.getElementById("track_name").innerText = song;
                document.getElementById('cover').setAttribute('src', cover)
                document.getElementById('background').style.backgroundImage = 'url(../public/covers/' + cover + ')';
                document.getElementById('disco-cover').style.backgroundImage = 'url(../public/covers/' + cover +
                ')';
                document.getElementById('disco-center').style.backgroundImage = 'url(../public/covers/ ' + cover +
                    ')';
                console.log(audio.duration);
            }


        }

        function nextSong() {
            var x = playlist[0].split('+');
            console.log('Playlist: ' + x );
            
            var cover = x[2].split('/')
            var lastind = cover.length;
            var cb  =  cover[lastind -1].replace('.PNG', '')
            console.log('play2('+x[1]+','+ x[0]+','+cb+')')
            play(x[1], x[0],cb);
            let y = document.getElementById('current-playlist');
            console.log(y.childNodes[1])
            y.removeChild(y.childNodes[1])
            playlist.shift()
        }

        function play_music() {
            document.getElementById('right-song-play').play();
            console.log('Playing!');
        }

        function pause_music() {
            document.getElementById('right-song-play').pause();
            console.log('Paused!');
        }

        function repeat_music() {
            document.getElementById('right-song-play').load();
            console.log('Repeating!');
            document.getElementById('right-song-play').play();
        }

        function addToPlaylist() {
            var artist = document.getElementById('artist').innerText;
            var name = document.getElementById('songn').innerText;
            var cover = document.getElementById('cover').src;
            console.log('Add to playlist  artist:' + artist + ' song ' + name + ' cover ' + cover)
            playlist.push(artist + '+' + name + '+' + cover);
            console.log(playlist)
            var para = document.createElement("P");
            var t = document.createTextNode(artist + ' ' + name);
            para.appendChild(t);
            document.getElementById('current-playlist').appendChild(para)
        }
        async function searchingArtist(art, err) {
            if (err) throw err;
            else {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        x = this.responseText;
                        x = x.replace(/.mp3/g, '')
                        //   console.log('x: ' + x)
                    }
                }
                try {
                    //     console.log('im trying ')
                    xhttp.open('GET', 'art/' + art + '.txt', false)
                    xhttp.send();
                    return x;
                } catch (error) {
                    console.log('error: ' + error)
                }
            }
        }

        function searching() {
            var tab = [];
            var songs = []
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = async function () {
                if (this.readyState == 4 && this.status == 200) {
                    var x = this.responseText;
                    console.log('xD: ' + x)
                    for (var i = 0; i < x.length; ++i) {
                        tab.push(x[i]);
                    }
                    var args = $.makeArray(x);
                    console.log('args: ' + args)
                    var d = args.toString().split(',')
                    console.log('d ' + d)
                    d.sort()
                    var n = getnumberofsongs();
                    for (var i = 0; i < d.length; i++) {
                        console.log('I ' + i)
                        var s = await searchingArtist(d[i]).then((result) => {
                            result = result.toString().split(',')
                            console.log('result length ' + result.length)
                            var len = parseInt(result.length)
                            if (len > 1) {
                                console.log('MAMY >1 ')
                                for (var l = 0; l < len; l++) {
                                    console.log('tab[' + l + '] ' + result[l])
                                    console.log(" its artis " + d[i])

                                    var song = result[l].toString();
                                    song = song.replace('\n', '')
                                    var art = d[i]
                                    var album = httpGet('http://localhost:3003/album?artist=' + art +
                                        '&' + 'song=' + song + '.mp3');

                                    var btn = document.createElement("BUTTON");
                                    btn.innerHTML = art + "  " + song;
                                    btn.setAttribute('id', d[i])
                                    console.log('play("' + song + '","' + art + '","' + album + '")')
                                    btn.setAttribute('onclick', 'play("' + song + '" ,"' + art +
                                        '", "' + album + '")')
                                    document.getElementById('left-menu').appendChild(btn)

                                }

                            } else {
                                // let  song = result.replace('.mp3','') 
                                console.log('tab[' + i + '] ' + result)
                                console.log('MAMY ELSE ')
                                //  console.log('its D :' + d + " its d[i] " + d[i])
                                //  console.log("Song: " + result[0])
                                //console.log("Song: " + result[0])
                                var song = result.toString();
                                song = song.replace('\n', '')
                                var art = d[i]
                                var album = httpGet('http://localhost:3003/album?artist=' + art + '&' +
                                    'song=' + song + '.mp3')

                                var btn = document.createElement("BUTTON");
                                btn.innerHTML = art + "  " + song;
                                btn.setAttribute('id', d[i])
                                console.log('play 2 (' + song + ',' + art + ', "' + album + '")')
                                btn.setAttribute('onclick', 'play("' + song + '","' + art + '", "' +
                                    album + '")')
                                document.getElementById('left-menu').appendChild(btn)
                            }
                            // $('.left-menu').append(' <button onclick="play('+ZTM+',"Taco Hemingway","Cafebelga")">'+song+ '</button>')
                        })
                    }
                };
            }
            xhttp.open('GET', 'artist.txt', true)
            xhttp.send();
        }

        function pushing(sngs, source) {
            for (var j = 0; j < source.length; ++j) {
                sngs.push(source[j]);
                console.log('songs: ' + sngs[j])
            }
            return sngs;
        }

        function elemele() {
            document.getElementById('current-playlist').innerText = (httpGet(
                'http://localhost:3003/album?artist=Eminem&song=Ringer.mp3'))
        }
    </script>
    <meta charset="UTF-8">
</head>

<body onload='searching()'>

    <div class="left-menu" id="left-menu">

        <button onclick="play('ZTM','Taco Hemingway','Cafebelga')">Taco Hemingway ZTM </button>
        <button onclick="play('Ringer', 'Eminem','Kamikaze')">Eminem Ringer </button>
        <button onclick="play('Gods plan','Drake', 'Scorpion')">Drake God's plan </button>
        <button onclick="play('I Am The Greatest', 'LOGIC','Incredible_True_Story')">LOGIC I Am The Greatest </button>

    </div>



    <div class="background" id='background'></div>

    <div class="container">
        <div class="navbar">
            <span class="left">
                <a href="#" title="Back"><i class="fa fa-arrow-left"></i></a>
            </span>
            <span class="right">
                <a href="#" title="Like"><i class="fa fa-heart-o"></i></a>
                <a href="#" onclick="addToPlaylist()" title="View More"><i class="fa fa-plus"></i></a>
            </span>
        </div>
        <div class="clearfix"></div>
        <div class="content">
            <div class="album-info">
                <figure class="disco">
                    <div class="disco-cover" id="disco-cover"></div>
                    <div class="disco-vinil" id="disco-vinil">
                        <div class="disco-center" id="disco-center"></div>
                    </div>
                </figure>
               
                <div class="album-music">
                    <h1 id="track_name">Time<h1>
                </div>
                <div class="album-artist">
                    <h6 id="track_artist">Pink Floyd</h6>
                </div>
                   

                <div class="player-buttons">
                    <a href="#" onclick="repeat_music()" id="repeat_track" title="Repeat"><i
                            class="fa fa-repeat"></i></a>
                    <a href="#" title="Back" class="prev-track"><i class="fa fa-backward"></i></a>
                    <a href="#" title="Pause" class="play-pause pause-active">
                        <i onclick="pause_music()" class="fa fa-pause"></i>
                        <i onclick="play_music()" class="fa fa-play"></i>

                    </a>
                    <a href="#" onclick="nextSong()" title="Next" class="next-track"><i class="fa fa-forward"></i></a>
                    <a href="#" id="random_track" title="Random"><i class="fa fa-random"></i></a>

                </div>
            </div>


        </div>
    </div>

    </div>

    </div>
    <div class="footer">
        <div class='now-playing'>

            <div class="player">
                <div align='left' class="song">
                    <div class="album">
                        <img id="cover" alt="Cover" src="nuta.png">
                    </div>
                    <div class="song-name" id="songn"> Name </div>
                    <div class="artist" id="artist"> Artist</div>

                    <audio preload="metadata" onended="nextSong()" buffered type="audio/mp3" id="right-song-play"
                        controls loop autoplay src="">
                        WALE WIADRO</audio>

                </div>
            </div>

        </div>
        <div class="current-playlist" id="current-playlist"> PLAYLIST:


        </div>
</body>