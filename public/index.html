<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <title>ELO player</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="icon" type="image/png"
        href="https://cdn.pixabay.com/photo/2016/03/23/20/49/music-note-1275650_960_720.png">
    <style>
        .playlist-play-button {
            min-height: 10px;
            height: 30%;
            color: lightblue;
            margin: auto;
            font-size: 60%;
            opacity: 0.6;
        }
        .addToPlaylistButton{
            background-color: aqua;
            color: whitesmoke;
            width:20%;
            padding: auto;
            height:auto;
            -webkit-transition-duration: 0.4s; /* Safari */
            transition-duration: 0.4s;
           
        }
        .background {
            position: fixed;
            background-image: url("./covers/Scorpion.png") center center;
            background-size: cover;


            height: 100%;
            width: 100%;
            margin: -0%;
            filter: blur(10px);
            -webkit-filter: blur(10px);
        }

        .playlist-song {
            background-color: #595959;
            overflow: auto;
            font-size: 50%;
        }

        .playlist {
            float: left;
            height: 70%;
            width: 50%;
            padding-left: 5%;
        }

        .cjenter {
            height: 20%;

            padding: 10%;
        }

        .playlist-button {
            min-height: 20px;
            height: fit-content;
            color: lightblue;
            margin: auto;
            padding: 3%;
            opacity: 0.6;
            border: solid;
            border-radius: 35px;
            width: 50%;
            height: 100%;
            font-size: 50vm;
            text-align: center;
        }

        .album-music,
        .album-artist {
            background-color: rgba(89, 89, 89, 0.226);
            color: whitesmoke;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: rgba(255, 255, 255, 0.4);
            font-size: 150%;
            width: 66%;
            text-align: center;
            margin-left: auto;
            margin-right: auto;
        }

        ::-webkit-scrollbar {
            width: 20px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            box-shadow: inset 0 0 5px grey;
            border-radius: 10px;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: #4d4d4d;
            border-radius: 10px;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: #262626;
        }

        .current-playlist {
            background-color: #333333;
            display: block;
            float: right;
            height: 90%;
            width: 65%;
            border-radius: 10px;
            border: 0.01% solid;
            padding-top: 1%;
            margin-bottom: 0.5%;
            margin-top: 0.5%;
            margin-right: 1%;

        }
        .div{
           
           margin: auto;
           padding: auto;
           display: table;
            height: 5%;
        }
        
        .left-menu-button {
            background-color: #262626;
            color: whitesmoke;
            border: thin #262626 solid;
            font-family:'Arial Narrow Bold', sans-serif;
            margin: auto;
            font-size: 25vm;
            width: 78%;
            height: inherit;  
            max-width: 80%;
            text-overflow: clip;
            -webkit-transition-duration: 0.4s; /* Safari */
            transition-duration: 0.4s;
            max-height: inherit;
        }
        .left-menu-button:hover{
            background-color: #4d4d4d;
            -webkit-transition: cubic-bezier(0.075, 0.82, 0.165, 1);
        }
        .addToPlaylistButton:hover{
            background-color: #333333;
        }
       button{
        background-color: #262626;
            color: whitesmoke;
            border: thin #262626 solid;
            margin: 1%;
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            font-size: medium;
            justify-content: center;
            align-items: center;
            width: 99%;
       }
        body {
            background-color: #1a1a1a;
        }

        .left-menu {
            float: left;
            background-color: #595959;
            color: whitesmoke;
            height: 85%;
            width: 20%;
            margin-left: 0.5%;
            border-radius: 2%;
            opacity: 0.7;
            overflow-y: scroll;
            padding-bottom: 0.5%;
            padding-top: 0.5%;
            padding-left: 0.25%;
            padding-right: 0.25%l
        }

        .main {
            color: whitesmoke;
        }

        .footer {
            background-color: #262626;
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            border-radius: 1%;
            color: white;
            text-align: center;
            height: 15%;
            opacity: 0.7;
        }

        .album {
            width: 50px;
            height: 50px;
            min-width: 20px;
            min-height: 20px;
            float: left;
            border: medium whitesmoke solid;
            margin: 3%;
            border-radius: 50px;
        }

        .now-playing {
            position: fixed;
            float: left;
            height: 30%;
            width: 30%;
            min-width: 180px;
            display: flex;
            padding-left: 1%;
            padding-bottom: 2%;
        }

        .artist {
            float: left;
            width: 30%;
            height: 25%;
            text-align: center;
            text-decoration-style: wavy;
            margin: 2%;
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            font-size: 110%;
        }

        .song-name {
            float: left;
            width: 40%;
            height: 30%;
            text-align: center;

            margin: 2%;
        }

        .song {
            margin-top: 2%;
            width: 100%;
            height: 50%;
            font-size: initial;
            background-color: #000;
            border-radius: 25px;
            align-content: center;
            max-width: 500px;
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            font-size: 110%;
        }

        img {
            border-radius: 30%;
            border: 1px;
            width: 100%;
            height: 100%;
        }

        #right-song-play {
            align-self: center;
            margin: 2%;
        }

        audio {
            width: 70%;
            height: 20%;
        }

        .player {
            width: 150%;
            height: 110%;
            margin-bottom: 5%;
        }

        .disco-cover {
            background-image: url("./covers/Scorpion.png") center center;
            background-size: cover;
            width: 200px;
            height: 200px;
            border-radius: 4px;
            overflow: hidden;
            z-index: 10;
            transition: transform 800ms cubic-bezier(0.39, 0.575, 0.565, 1);
        }

        .disco-center {
            width: 61px;
            height: 61px;
            position: relative;
            top: 70px;
            left: 70px;
            /* text-align: center; */
            border-radius: 50%;
            background-image: url("./covers/Scorpion.png");
            background-size: cover;
        }

        .temp-playlist {
            float: right;
            height: 70%;
            width: 50%;
            padding-right: 5%;
            overflow: auto;
            margin: 0;
        }
    </style>

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet prefetch" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <script>
        var playlist = [];
        var numberofsongs;
        var currentId = null ; 
        function readPlaylists() {}

        function savePlaylist() {
            console.log('Playlist ' + playlist);
            

            // tu damy playlist normalne bo kurwa zgubiłem się 
        }

        function httpGet(theUrl) {
            var xmlHttp = null;
            xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", theUrl, false);
            xmlHttp.send(null);
            return xmlHttp.responseText;
        }

        function httpPut(theUrl) {
            var xmlHttp = null;
            xmlHttp = new XMLHttpRequest();
            xmlHttp.open("PUT", theUrl, false);
            xmlHttp.send(null);
            return xmlHttp.responseText;
        }

        function getnumberofsongs() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    numberofsongs = this.responseText;
                    console.log('number: ' + numberofsongs)
                }
            }
            try {
                //  console.log('im trying ')
                xhttp.open('GET', 'number.txt', false)
                xhttp.send();
                return numberofsongs;
            } catch (error) {
                console.log('error: ' + error)
            }
        }

        function play(song, artist, cover , id) {
            var audio = document.getElementById('right-song-play');
            var buffer = audio.buffered

            audio.src = 'http://localhost:3003/music?id=' + song + '.mp3&name=' + song + '.mp3&artist=' + artist +
                '&album=' + cover;
            audio.onloadeddata = function () {
                document.getElementById('artist').innerText = artist;
                document.getElementById('songn').innerText = song;
                document.getElementById("track_artist").innerText = artist;
                document.getElementById("track_name").innerText = song;

                cover.toString()
                console.log('play(' + song + ',' + artist + ',' + cover + ')')
                cover = cover.replace(/ /g, '_');
                console.log('REPLACED ' + cover)
                document.getElementById('cover').setAttribute('src', '../public/covers/' + cover + '.PNG')
                document.getElementById('background').style.backgroundImage = 'url(../public/covers/' + cover +
                    '.PNG)';
                document.getElementById('disco-cover').style.backgroundImage = 'url(../public/covers/' + cover +
                    '.PNG)';
                document.getElementById('disco-center').style.backgroundImage = 'url(../public/covers/' + cover +
                    '.PNG)';
                console.log('Audio link : ' + audio.src)
            }
            audio.onended = () => {
                console.log("Song ended. Playing next song ");
                nextSong(id+1);

            }

        }

        function play2(song, artist, cover, id) {
            var audio = document.getElementById('right-song-play');
            var buffer = audio.buffered

            audio.src = 'http://localhost:3003/music?id=' + song + '.mp3&name=' + song + '.mp3&artist=' + artist +
                '&album=' + cover;
            audio.onloadeddata = function () {
                document.getElementById('artist').innerText = artist;
                document.getElementById('songn').innerText = song;
                document.getElementById("track_artist").innerText = artist;
                document.getElementById("track_name").innerText = song;

                cover.toString()
                console.log('play(' + song + ',' + artist + ',' + cover + ')')
                cover = cover.replace(/ /g, '_');
                console.log('REPLACED ' + cover)
                document.getElementById('cover').setAttribute('src', '../public/covers/' + cover + '.PNG')
                document.getElementById('background').style.backgroundImage = 'url(../public/covers/' + cover +
                    '.PNG)';
                document.getElementById('disco-cover').style.backgroundImage = 'url(../public/covers/' + cover +
                    '.PNG)';
                document.getElementById('disco-center').style.backgroundImage = 'url(../public/covers/' + cover +
                    '.PNG)';
                console.log('Audio link : ' + audio.src)
            }
            audio.onended = () => {
                console.log("Song ended. Playing next song ");
                nextSong(id+1);

            }


        }

        function nextSong(id) {
            console.log("nextsong ! ")
            if (playlist.length >= 1) {
                var x = playlist[0].split('+');
                console.log('Playlist: ' + x);

                var cover = x[2].split('/')
                var lastind = cover.length;
                var cb = cover[lastind - 1].replace('.PNG', '')
                console.log('play2(' + x[1] + ',' + x[0] + ',' + cb + ')')
                play(x[1].trim(), x[0].trim(), cb.trim());
                let y = document.getElementById('temp-playlist');
                console.log(+y.childNodes[1])
                y.removeChild(y.childNodes[1])
                playlist.shift()
            }
            else if (playlist.length == 0 ){
               document.getElementById(id).click();
            }

        }

        function play_music() {
            document.getElementById('right-song-play').play();

        }

        function pause_music() {
            document.getElementById('right-song-play').pause();
            console.log('Paused!');
        }

        function repeat_music() {
            document.getElementById('right-song-play').load();
            console.log('Repeating!');
            document.getElementById('right-song-play').play();
        }

        function addToPlaylist2(name,artist,cover) {
           
            cover2 = cover.replace("http://localhost:3003/public/covers/", "")
            cover2 = cover2.replace(".PNG", "")
            console.log('Add to playlist  artist:' + artist + ' song ' + name + ' cover ' + cover2)
            playlist.push(artist + ' + ' + name + ' + ' + cover2);

            var d = document.createElement("button");
            d.className = 'playlist-play-button';

            d.onclick = function () {
                let y = document.getElementById('temp-playlist');
                console.log(+y.childNodes[1])
                y.removeChild(this);
                playlist.shift()
                play(name, artist, cover2);
            }
            d.textContent = artist + " " + name;


            document.getElementById('temp-playlist').appendChild(d)
        }

        function addToPlaylist() {
            var artist = document.getElementById('artist').innerText;
            var name = document.getElementById('songn').innerText;
            var cover = document.getElementById('cover').src;
            cover2 = cover.replace("http://localhost:3003/public/covers/", "")
            cover2 = cover2.replace(".PNG", "")
            console.log('Add to playlist  artist:' + artist + ' song ' + name + ' cover ' + cover2)
            playlist.push(artist + ' + ' + name + ' + ' + cover2);

            var d = document.createElement("button");
            d.className = 'playlist-play-button';

            d.onclick = function () {
                let y = document.getElementById('temp-playlist');
                console.log(+y.childNodes[1])
                y.removeChild(this);
                playlist.shift()
                play(name, artist, cover2);
            }
            d.textContent = artist + " " + name;


            document.getElementById('temp-playlist').appendChild(d)
        }
        async function searchingArtist(art, err) {
            if (err) throw err;
            else {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        x = this.responseText;
                        x = x.replace(/.mp3/g, '')
                        //   console.log('x: ' + x)
                    }
                }
                try {
                    //     console.log('im trying ')
                    xhttp.open('GET', 'art/' + art + '.txt', false)
                    xhttp.send();
                    return x;
                } catch (error) {
                    console.log('error: ' + error)
                }
            }
        }

        function searching() {
            var tab = [];
            var songs = []
            var xhttp = new XMLHttpRequest();
            var nr = 0;
            xhttp.onreadystatechange = async function () {
                if (this.readyState == 4 && this.status == 200) {
                    var x = this.responseText;
                    console.log('xD: ' + x)
                    for (var i = 0; i < x.length; ++i) {
                        tab.push(x[i]);
                    }
                    var args = $.makeArray(x);
                    console.log('args: ' + args)
                    var d = args.toString().split(',')
                    console.log('d ' + d)
                    d.sort()
                    var n = getnumberofsongs();
                    for (var i = 0; i < d.length; i++) {
                        console.log('I ' + i)
                        var s = await searchingArtist(d[i]).then((result) => {
                            result = result.toString().split(',')
                            // console.log('result length ' + result.length)
                            var len = parseInt(result.length)
                            if (len > 1) {

                                for (var l = 0; l < len; l++) {

                                    var song = result[l].toString();
                                    song = song.replace('\n', '')
                                    var art = d[i]
                                    var album = httpGet('http://localhost:3003/album?artist=' + art +
                                        '&' + 'song=' + song + '.mp3');
                                    var p = document.createElement('div');
                                    nr ++; 
                                   
                                    var btn = document.createElement("BUTTON");
                                    var btn2 = document.createElement('button');
                                   
                                    btn2.innerHTML = "&#43"
                                    btn2.setAttribute('class', 'addToPlaylistButton');
                                    btn.innerHTML = art + "  " + song;
                                    btn.setAttribute('class','left-menu-button')
                                    btn.setAttribute('id',nr)
                                    btn.setAttribute('onclick', 'play("' + song + '" ,"' + art + '", "' + album + '",'+nr+')');
                                    btn2.setAttribute('onclick', 'addToPlaylist2("'+song+'","'+art+'","'+album+'")');
                                    p.appendChild(btn);
                                    p.appendChild(btn2);
                                    document.getElementById('left-menu').appendChild(p)

                                }

                            } else {
                                // let  song = result.replace('.mp3','') 

                                //  console.log('its D :' + d + " its d[i] " + d[i])
                                //  console.log("Song: " + result[0])
                                //console.log("Song: " + result[0])
                                var song = result.toString();
                                song = song.replace('\n', '')
                                var art = d[i]
                                var album = httpGet('http://localhost:3003/album?artist=' + art + '&' +
                                    'song=' + song + '.mp3')
                                var p = document.createElement('p')
                                var btn = document.createElement("BUTTON");
                                var btn2 = document.createElement('button');
                                btn.innerHTML = art + "  " + song;
                                btn.setAttribute('id', d[i])
                                btn2.innerHTML = "&#43";
                                btn2.setAttribute('class', 'addToPlaylistButton');
                                nr++ ;
                                btn.setAttribute('id',nr)        
                                btn.setAttribute('onclick', 'play("' + song + '","' + art + '", "' +
                                    album + '")');
                                btn2.setAttribute('ondbclick', 'addToPlaylist2("'+song+'","'+art+'","'+album+'",'+nr+')');
                                p.appendChild(btn);
                                p.appendChild(btn2);
                                document.getElementById('left-menu').appendChild(p)
                            }
                            // $('.left-menu').append(' <button onclick="play('+ZTM+',"Taco Hemingway","Cafebelga")">'+song+ '</button>')
                        })
                    }
                };
            }
            xhttp.open('GET', 'artist.txt', true)
            xhttp.send();
        }

        function pushing(sngs, source) {
            for (var j = 0; j < source.length; ++j) {
                sngs.push(source[j]);
                console.log('songs: ' + sngs[j])
            }
            return sngs;
        }

        function elemele() {
            document.getElementById('current-playlist').innerText = (httpGet(
                'http://localhost:3003/album?artist=Eminem&song=Ringer.mp3'))
        }
    </script>
    <meta charset="UTF-8">
</head>

<body onload='searching()'>

    <div class="left-menu" id="left-menu">


    </div>



    <div class="background" id='background'></div>

    <div class="container">
        <div class="navbar">
            <span class="left">

            </span>
            <span class="right">
                <a href="#" title="Like"><i class="fa fa-heart-o"></i></a>
                <a href="#" onclick="addToPlaylist()" title="View More"><i class="fa fa-plus"></i></a>
            </span>
        </div>
        <div class="clearfix"></div>
        <div class="content">
            <div class="album-info">
                <figure class="disco">
                    <div class="disco-cover" id="disco-cover"></div>
                    <div class="disco-vinil" id="disco-vinil">
                        <div class="disco-center" id="disco-center"></div>
                    </div>
                </figure>

                <div class="album-music">
                    <h1 id="track_name">Song<h1>
                </div>
                <div class="album-artist">
                    <h6 id="track_artist">Artist</h6>
                </div>


                <div class="player-buttons">
                    <a href="#" onclick="repeat_music()" id="repeat_track" title="Repeat"><i
                            class="fa fa-repeat"></i></a>
                    <a href="#" title="Back" class="prev-track"><i class="fa fa-backward"></i></a>
                    <a href="#" title="Pause" class="play-pause pause-active">
                        <i onclick="pause_music()" class="fa fa-pause"></i>
                        <i onclick="play_music()" class="fa fa-play"></i>

                    </a>
                    <a href="#" onclick="nextSong()" title="Next" class="next-track"><i class="fa fa-forward"></i></a>
                    <a href="#" id="random_track" title="Random"><i class="fa fa-random"></i></a>

                </div>
                    <center class="cjenter"> <button onclick="savePlaylist()" class="playlist-button">Save current playlist</button>
        </center>
            </div>


        </div>
        
    </div>

    </div>

    </div>
    <div class="footer">
        <div class='now-playing'>

            <div class="player">
                <div align='left' class="song">
                    <div class="album">
                        <img id="cover" alt="Cover" src="nuta.png">
                    </div>
                    <div class="song-name" id="songn"> Name </div>
                    <div class="artist" id="artist"> Artist</div>

                    <audio preload="metadata" onended="nextSong()" buffered type="audio/mp3" id="right-song-play"
                        controls autoplay src="">
                        WALE WIADRO</audio>

                </div>
            </div>

        </div>
        <div class="current-playlist" id="current-playlist">
            <div class="playlist" id="playlist" onload="readPlaylists()">
                TU BYDZIE PALYLISTA

            </div>

            <div class="temp-playlist" id="temp-playlist">
                TEMP PLAYLIST
            </div>


        </div>
</body>